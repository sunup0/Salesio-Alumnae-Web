'use client'

import { useState, useMemo, useEffect, Suspense } from 'react'
import { useSearchParams } from 'next/navigation'
import { Input } from "@/components/ui/input"
import { Button } from "@/components/ui/button"
import { Card, CardContent } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Avatar, AvatarFallback } from "@/components/ui/avatar"
import { Search, Filter, MapPin, Briefcase, ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight, Plus, Mail, Phone, Hash } from "lucide-react"
import { fakerKO as faker } from '@faker-js/faker'
import { toast } from "sonner"
import { supabase } from "@/utils/supabase/client"
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle,
    DialogTrigger,
} from "@/components/ui/dialog"
import { Label } from "@/components/ui/label"
import {
    Select,
    SelectContent,
    SelectItem,
    SelectTrigger,
    SelectValue,
} from "@/components/ui/select"
import {
    Sheet,
    SheetContent,
    SheetDescription,
    SheetHeader,
    SheetTitle,
    SheetTrigger,
} from "@/components/ui/sheet"
import { Separator } from "@/components/ui/separator"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { Checkbox } from "@/components/ui/checkbox"
import { Slider } from "@/components/ui/slider"

// Mock Data Generation


const ITEMS_PER_PAGE = 12

// Mock Data Generation (for fallback/seeding only)
const generateAlumnae = (count: number, startId: number = 1) => {
    return Array.from({ length: count }, (_, i) => ({
        // ID is auto-generated by DB
        name: faker.person.fullName(),
        cohort: faker.number.int({ min: 1, max: 60 }),
        region: faker.helpers.arrayElement(['ì„œìš¸ ê°•ë‚¨', 'ì„œìš¸ ì„œì´ˆ', 'ì„œìš¸ ë§ˆí¬', 'ê²½ê¸° ë¶„ë‹¹', 'ë¶€ì‚° í•´ìš´ëŒ€', 'ë¯¸êµ­ ë‰´ìš•', 'í˜¸ì£¼ ì‹œë“œë‹ˆ', 'ê´‘ì£¼ ë™êµ¬', 'ëŒ€êµ¬ ìˆ˜ì„±']),
        job: faker.person.jobTitle(),
        company: faker.company.name(),
        tags: faker.helpers.arrayElements(['IT', 'ìŠ¤íƒ€íŠ¸ì—…', 'ë²•ë¥ ', 'ì˜ë£Œ', 'êµìœ¡', 'F&B', 'ê¸ˆìœµ', 'ì˜ˆìˆ ', 'í•´ì™¸', 'ë§ˆì¼€íŒ…'], { min: 1, max: 2 }),
        email: faker.internet.email(),
        phone: faker.phone.number(),
        introduction: faker.lorem.paragraph(),
        birthday: faker.date.birthdate().toISOString().slice(5, 10), // MM-DD
        payment_status: faker.helpers.arrayElement(['paid', 'unpaid']),
    }))
}

export default function DirectoryPage() {
    return (
        <Suspense fallback={<div className="flex h-[50vh] items-center justify-center">Loading...</div>}>
            <DirectoryContent />
        </Suspense>
    )
}

function DirectoryContent() {
    const searchParams = useSearchParams()

    // State for Alumnae List
    const [alumnaeList, setAlumnaeList] = useState<any[]>([])
    const [isLoaded, setIsLoaded] = useState(false)
    const [searchTerm, setSearchTerm] = useState('')
    const [currentPage, setCurrentPage] = useState(1)
    const [isDialogOpen, setIsDialogOpen] = useState(false)
    const [selectedAlumna, setSelectedAlumna] = useState<any>(null)
    const [editingId, setEditingId] = useState<number | null>(null)

    // Filter States
    const [selectedRegions, setSelectedRegions] = useState<string[]>([])
    const [selectedTags, setSelectedTags] = useState<string[]>([])
    const [cohortRange, setCohortRange] = useState([1, 60])
    const [paymentFilter, setPaymentFilter] = useState<'all' | 'paid' | 'unpaid'>('all')
    const [birthdayFilter, setBirthdayFilter] = useState<'all' | 'today' | 'month'>('all')

    const uniqueRegions = useMemo(() => Array.from(new Set(alumnaeList.map(a => a.region))).sort(), [alumnaeList])
    const uniqueTags = useMemo(() => Array.from(new Set(alumnaeList.flatMap(a => a.tags))).sort(), [alumnaeList])

    // Load data from Supabase on mount
    const fetchAlumnae = async () => {
        setIsLoaded(false)
        const { data, error } = await supabase
            .from('alumnae')
            .select('*')
            .order('name', { ascending: true })

        if (error) {
            console.error('Error fetching alumnae:', error)
            toast.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", { description: error.message })
        } else {
            setAlumnaeList(data || [])
        }
        setIsLoaded(true)
    }

    useEffect(() => {
        fetchAlumnae()
    }, [])



    // Apply URL Params Filters
    useEffect(() => {
        const cohortParam = searchParams.get('cohort')
        const regionParam = searchParams.get('region')
        const searchParam = searchParams.get('search')
        const paymentParam = searchParams.get('payment')
        const birthdayParam = searchParams.get('birthday')

        if (cohortParam) {
            const cohort = parseInt(cohortParam)
            if (!isNaN(cohort)) {
                setCohortRange([cohort, cohort])
            }
        }
        if (regionParam) {
            setSelectedRegions([regionParam])
        }
        if (searchParam) {
            setSearchTerm(searchParam)
        }
        if (paymentParam === 'paid' || paymentParam === 'unpaid') {
            setPaymentFilter(paymentParam)
        }
        if (birthdayParam === 'today' || birthdayParam === 'month') {
            setBirthdayFilter(birthdayParam)
        }

        const tagParam = searchParams.get('tag')
        if (tagParam) {
            setSelectedTags([tagParam])
        }
    }, [searchParams])




    // Form State
    const [formData, setFormData] = useState({
        name: '',
        cohort: '',
        region: 'ì„œìš¸ ê°•ë‚¨',
        job: '',
        company: '',
        email: '',
        phone: '',
        introduction: '',
        tags: '',
    })

    // Filter Logic
    const filteredAlumnae = useMemo(() => {
        if (!isLoaded) return []

        return alumnaeList.filter(person => {
            const matchesSearch =
                person.name.includes(searchTerm) ||
                person.cohort.toString().includes(searchTerm) ||
                person.job.includes(searchTerm) ||
                person.tags.some((tag: string) => tag.includes(searchTerm))

            const matchesRegion = selectedRegions.length === 0 || selectedRegions.includes(person.region)
            const matchesCohort = person.cohort >= cohortRange[0] && person.cohort <= cohortRange[1]
            const matchesTags = selectedTags.length === 0 || selectedTags.some(tag => person.tags.includes(tag))

            let matchesPayment = true
            if (paymentFilter !== 'all') {
                matchesPayment = person.payment_status === paymentFilter
            }

            let matchesBirthday = true
            if (birthdayFilter !== 'all') {
                const today = new Date()
                const todayStr = today.toISOString().slice(5, 10) // MM-DD
                const personBirthMM = person.birthday?.slice(0, 2)
                const currentMonth = (today.getMonth() + 1).toString().padStart(2, '0')

                if (birthdayFilter === 'today') {
                    matchesBirthday = person.birthday === todayStr
                } else if (birthdayFilter === 'month') {
                    matchesBirthday = personBirthMM === currentMonth
                }
            }

            return matchesSearch && matchesRegion && matchesCohort && matchesTags && matchesPayment && matchesBirthday
        })
    }, [searchTerm, alumnaeList, selectedRegions, cohortRange, selectedTags, paymentFilter, birthdayFilter])

    // Pagination Logic
    const totalPages = Math.ceil(filteredAlumnae.length / ITEMS_PER_PAGE)
    const paginatedAlumnae = useMemo(() => {
        const start = (currentPage - 1) * ITEMS_PER_PAGE
        return filteredAlumnae.slice(start, start + ITEMS_PER_PAGE)
    }, [filteredAlumnae, currentPage])

    // Handlers
    const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {
        setSearchTerm(e.target.value)
        setCurrentPage(1)
    }

    const toggleRegion = (region: string) => {
        setSelectedRegions(prev =>
            prev.includes(region)
                ? prev.filter(r => r !== region)
                : [...prev, region]
        )
        setCurrentPage(1)
    }

    const toggleTag = (tag: string) => {
        setSelectedTags(prev =>
            prev.includes(tag)
                ? prev.filter(t => t !== tag)
                : [...prev, tag]
        )
        setCurrentPage(1)
    }

    const resetFilters = () => {
        setSelectedRegions([])
        setSelectedTags([])
        setCohortRange([1, 60])
        setPaymentFilter('all')
        setBirthdayFilter('all')
        setCurrentPage(1)
        toast.info("í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")
    }

    const handleDeleteAll = async () => {
        if (window.confirm("ì •ë§ë¡œ ëª¨ë“  ë™ë¬¸ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (DBì—ì„œ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤)")) {
            // Supabase doesn't support easy bulk delete of all without WHERE, so we delete where ID > 0
            const { error } = await supabase.from('alumnae').delete().gt('id', 0)

            if (error) {
                toast.error("ì‚­ì œ ì‹¤íŒ¨", { description: error.message })
            } else {
                setAlumnaeList([])
                toast.success("ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")
            }
        }
    }

    // Individual Delete
    const handleDelete = async (id: number) => {
        if (window.confirm("ì´ ë™ë¬¸ ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            const { error } = await supabase.from('alumnae').delete().eq('id', id)

            if (error) {
                toast.error("ì‚­ì œ ì‹¤íŒ¨", { description: error.message })
            } else {
                setAlumnaeList(prev => prev.filter(p => p.id !== id))
                setSelectedAlumna(null) // Close detail sheet
                toast.success("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")
            }
        }
    }

    // Prepare Edit
    const handleEdit = (alumna: any) => {
        setFormData({
            name: alumna.name,
            cohort: alumna.cohort.toString(),
            region: alumna.region,
            job: alumna.job,
            company: alumna.company,
            email: alumna.email,
            phone: alumna.phone,
            introduction: alumna.introduction,
            tags: alumna.tags.join(', '),
        })
        setEditingId(alumna.id)
        setIsDialogOpen(true)
    }

    const handleSubmit = () => {
        // Validation
        const errors: string[] = []
        if (!formData.name.trim()) errors.push("ì´ë¦„")
        if (!formData.cohort) errors.push("ê¸°ìˆ˜")
        if (formData.cohort && isNaN(parseInt(formData.cohort))) errors.push("ê¸°ìˆ˜(ìˆ«ì)")

        if (errors.length > 0) {
            toast.error("ì…ë ¥ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”", {
                description: `ë‹¤ìŒ í•­ëª©ì´ ëˆ„ë½ë˜ì—ˆê±°ë‚˜ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤: ${errors.join(', ')}`
            })
            return
        }

        const commonData = {
            name: formData.name,
            cohort: parseInt(formData.cohort),
            region: formData.region as any,
            job: formData.job || 'ì§ì—… ë¯¸ì…ë ¥',
            company: formData.company || 'ì†Œì† ë¯¸ì…ë ¥',
            tags: formData.tags ? formData.tags.split(',').map(t => t.trim()).filter(t => t) : ['ì‹ ê·œíšŒì›'],
            email: formData.email || 'email@example.com',
            phone: formData.phone || '010-0000-0000',
            introduction: formData.introduction || 'ì•ˆë…•í•˜ì„¸ìš”!',
            birthday: faker.date.birthdate().toISOString().slice(5, 10), // Random for new
            paymentStatus: 'unpaid' // Default
        }

        if (editingId) {
            // Update Existing
            setAlumnaeList(prev => prev.map(p => p.id === editingId ? { ...p, ...commonData } : p))

            // If currently viewing this person, update the view too
            if (selectedAlumna && selectedAlumna.id === editingId) {
                setSelectedAlumna({ ...selectedAlumna, ...commonData })
            }

            toast.success("ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
        } else {
            // Create New
            const newAlumna = {
                id: alumnaeList.length > 0 ? Math.max(...alumnaeList.map(a => a.id)) + 1 : 1,
                ...commonData
            }
            setAlumnaeList([newAlumna, ...alumnaeList])
            toast.success("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!", {
                description: `${newAlumna.name} ë™ë¬¸ë‹˜ì´ ëª…ë‹¨ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`
            })
            setSearchTerm('')
            setCurrentPage(1)
        }

        setIsDialogOpen(false)
        setEditingId(null)
        setFormData({
            name: '', cohort: '', region: 'ì„œìš¸ ê°•ë‚¨', job: '', company: '',
            email: '', phone: '', introduction: '', tags: ''
        })
    }

    return (
        <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-700">
            {/* Header */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 className="text-3xl font-bold tracking-tight text-primary">ë™ë¬¸ ì¸ëª…ë¡ ğŸ‘¥</h1>
                    <p className="text-muted-foreground mt-1">ì´ {alumnaeList.length}ëª…ì˜ ìë‘ìŠ¤ëŸ¬ìš´ ë™ë¬¸ë“¤ì´ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div className="flex gap-2 w-full md:w-auto">
                    <div className="relative flex-1 md:w-64">
                        <Search className="absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground" />
                        <Input
                            placeholder="ì´ë¦„, ê¸°ìˆ˜, ì§ì—…, íƒœê·¸ ê²€ìƒ‰..."
                            className="pl-9 glass"
                            value={searchTerm}
                            onChange={handleSearch}
                        />
                    </div>
                    <Button variant="ghost" onClick={handleDeleteAll} className="text-destructive hover:text-destructive/90 hover:bg-destructive/10">
                        ì „ì²´ ì‚­ì œ
                    </Button>
                    {/* Filter Popover */}
                    <Popover>
                        <PopoverTrigger asChild>
                            <Button variant="outline" className={`glass gap-2 ${selectedRegions.length > 0 || selectedTags.length > 0 || paymentFilter !== 'all' || birthdayFilter !== 'all' || cohortRange[0] !== 1 || cohortRange[1] !== 60 ? 'border-primary text-primary bg-primary/5' : ''}`}>
                                <Filter className="w-4 h-4" />
                                í•„í„°
                                {(selectedRegions.length > 0 || selectedTags.length > 0 || paymentFilter !== 'all' || birthdayFilter !== 'all' || cohortRange[0] !== 1 || cohortRange[1] !== 60) && <Badge variant="secondary" className="ml-1 h-5 px-1 bg-primary text-white">ON</Badge>}
                            </Button>
                        </PopoverTrigger>
                        <PopoverContent className="w-80 bg-background border border-border shadow-lg p-4" align="end">
                            <div className="space-y-4 max-h-[60vh] overflow-y-auto">
                                <div className="flex items-center justify-between">
                                    <h4 className="font-semibold leading-none flex items-center gap-2"><Filter className="w-3.5 h-3.5" /> ìƒì„¸ í•„í„°</h4>
                                    <Button variant="ghost" size="sm" onClick={resetFilters} className="h-auto p-0 text-xs text-muted-foreground hover:text-red-500 transition-colors">
                                        ì´ˆê¸°í™”
                                    </Button>
                                </div>
                                <Separator />
                                {/* Status Filters */}
                                <div className="grid grid-cols-2 gap-2">
                                    <div className="space-y-2">
                                        <Label className="text-xs text-muted-foreground">ë‚©ë¶€ ìƒíƒœ</Label>
                                        <Select value={paymentFilter} onValueChange={(v: any) => setPaymentFilter(v)}>
                                            <SelectTrigger className="h-8 text-xs">
                                                <SelectValue placeholder="ì „ì²´" />
                                            </SelectTrigger>
                                            <SelectContent>
                                                <SelectItem value="all">ì „ì²´</SelectItem>
                                                <SelectItem value="paid">ë‚©ë¶€ ì™„ë£Œ</SelectItem>
                                                <SelectItem value="unpaid">ë¯¸ë‚©</SelectItem>
                                            </SelectContent>
                                        </Select>
                                    </div>
                                    <div className="space-y-2">
                                        <Label className="text-xs text-muted-foreground">ìƒì¼</Label>
                                        <Select value={birthdayFilter} onValueChange={(v: any) => setBirthdayFilter(v)}>
                                            <SelectTrigger className="h-8 text-xs">
                                                <SelectValue placeholder="ì „ì²´" />
                                            </SelectTrigger>
                                            <SelectContent>
                                                <SelectItem value="all">ì „ì²´</SelectItem>
                                                <SelectItem value="today">ì˜¤ëŠ˜</SelectItem>
                                                <SelectItem value="month">ì´ë²ˆ ë‹¬</SelectItem>
                                            </SelectContent>
                                        </Select>
                                    </div>
                                </div>
                                <Separator />
                                {/* Cohort Filter */}
                                <div className="space-y-3">
                                    <h5 className="text-sm font-medium text-muted-foreground flex justify-between">
                                        <span>ê¸°ìˆ˜ ë²”ìœ„</span>
                                        <span className="text-primary font-bold">{cohortRange[0]}íšŒ ~ {cohortRange[1]}íšŒ</span>
                                    </h5>
                                    <Slider
                                        defaultValue={[1, 60]}
                                        value={cohortRange}
                                        min={1}
                                        max={60}
                                        step={1}
                                        onValueChange={setCohortRange}
                                        className="py-2"
                                    />
                                </div>
                                <Separator />
                                {/* Region Filter */}
                                <div className="space-y-3">
                                    <h5 className="text-sm font-medium text-muted-foreground">í™œë™ ì§€ì—­ ({selectedRegions.length > 0 ? selectedRegions.length : 'ì „ì²´'})</h5>
                                    <div className="grid grid-cols-2 gap-2">
                                        {uniqueRegions.map(region => (
                                            <div key={region} className="flex items-center space-x-2">
                                                <Checkbox
                                                    id={`filter-${region}`}
                                                    checked={selectedRegions.includes(region)}
                                                    onCheckedChange={() => toggleRegion(region)}
                                                />
                                                <Label htmlFor={`filter-${region}`} className="text-sm cursor-pointer hover:text-primary transition-colors">{region}</Label>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <Separator />
                                {/* Tags Filter */}
                                <div className="space-y-3">
                                    <h5 className="text-sm font-medium text-muted-foreground">ê´€ì‹¬ íƒœê·¸ ({selectedTags.length > 0 ? selectedTags.length : 'ì „ì²´'})</h5>
                                    <div className="flex flex-wrap gap-2">
                                        {uniqueTags.map(tag => (
                                            <div key={tag}
                                                className={`cursor-pointer px-2 py-1 rounded-md text-xs border transition-colors ${selectedTags.includes(tag) ? 'bg-primary text-primary-foreground border-primary' : 'bg-muted hover:bg-muted/80 border-transparent'}`}
                                                onClick={() => toggleTag(tag)}
                                            >
                                                #{tag}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </PopoverContent>
                    </Popover>

                    {/* Registration/Edit Dialog */}
                    <Dialog open={isDialogOpen} onOpenChange={(open) => {
                        setIsDialogOpen(open)
                        if (!open) {
                            setEditingId(null)
                            setFormData({
                                name: '', cohort: '', region: 'ì„œìš¸ ê°•ë‚¨', job: '', company: '',
                                email: '', phone: '', introduction: '', tags: ''
                            })
                        }
                    }}>
                        <DialogTrigger asChild>
                            <Button className="bg-primary hover:bg-primary/90 gap-2">
                                <Plus className="w-4 h-4" /> ë™ë¬¸ ë“±ë¡
                            </Button>
                        </DialogTrigger>
                        <DialogContent className="sm:max-w-[500px] bg-background border-border shadow-lg max-h-[90vh] overflow-y-auto">
                            <DialogHeader>
                                <DialogTitle>{editingId ? 'ë™ë¬¸ ì •ë³´ ìˆ˜ì •' : 'ìƒˆë¡œìš´ ë™ë¬¸ ë“±ë¡'}</DialogTitle>
                                <DialogDescription>
                                    {editingId ? 'ì •ë³´ë¥¼ ìˆ˜ì •í•˜ë©´ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.' : 'ëª¨ë“  ì •ë³´ë¥¼ ìƒì„¸íˆ ì…ë ¥í•´ì£¼ì‹œë©´ ë‹¤ë¥¸ ë™ë¬¸ë“¤ì´ ë” ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'}
                                </DialogDescription>
                            </DialogHeader>
                            <div className="grid gap-4 py-4">
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="name" className="text-right">ì´ë¦„ <span className="text-red-500">*</span></Label>
                                    <Input id="name" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} className="col-span-3" placeholder="í™ê¸¸ë™" />
                                </div>
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="cohort" className="text-right">ê¸°ìˆ˜ <span className="text-red-500">*</span></Label>
                                    <Input id="cohort" type="number" value={formData.cohort} onChange={(e) => setFormData({ ...formData, cohort: e.target.value })} className="col-span-3" placeholder="30" />
                                </div>
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="email" className="text-right">ì´ë©”ì¼</Label>
                                    <Input id="email" type="email" value={formData.email} onChange={(e) => setFormData({ ...formData, email: e.target.value })} className="col-span-3" placeholder="example@salesio.com" />
                                </div>
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="phone" className="text-right">ì „í™”ë²ˆí˜¸</Label>
                                    <Input id="phone" value={formData.phone} onChange={(e) => setFormData({ ...formData, phone: e.target.value })} className="col-span-3" placeholder="010-1234-5678" />
                                </div>
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="region" className="text-right">ì§€ì—­</Label>
                                    <Select value={formData.region} onValueChange={(v) => setFormData({ ...formData, region: v })}>
                                        <SelectTrigger className="col-span-3">
                                            <SelectValue placeholder="ì§€ì—­ ì„ íƒ" />
                                        </SelectTrigger>
                                        <SelectContent>
                                            <SelectItem value="ì„œìš¸ ê°•ë‚¨">ì„œìš¸ ê°•ë‚¨</SelectItem>
                                            <SelectItem value="ì„œìš¸ ì„œì´ˆ">ì„œìš¸ ì„œì´ˆ</SelectItem>
                                            <SelectItem value="ê²½ê¸° ë¶„ë‹¹">ê²½ê¸° ë¶„ë‹¹</SelectItem>
                                            <SelectItem value="ë¶€ì‚° í•´ìš´ëŒ€">ë¶€ì‚° í•´ìš´ëŒ€</SelectItem>
                                            <SelectItem value="í•´ì™¸">í•´ì™¸</SelectItem>
                                        </SelectContent>
                                    </Select>
                                </div>
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="job" className="text-right">ì§ì—…</Label>
                                    <Input id="job" value={formData.job} onChange={(e) => setFormData({ ...formData, job: e.target.value })} className="col-span-3" placeholder="ê°œë°œì" />
                                </div>
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="company" className="text-right">ì†Œì†</Label>
                                    <Input id="company" value={formData.company} onChange={(e) => setFormData({ ...formData, company: e.target.value })} className="col-span-3" placeholder="ì‚¼ì„±ì „ì" />
                                </div>
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="tags" className="text-right">íƒœê·¸</Label>
                                    <Input id="tags" value={formData.tags} onChange={(e) => setFormData({ ...formData, tags: e.target.value })} className="col-span-3" placeholder="IT, ìŠ¤íƒ€íŠ¸ì—… (ì‰¼í‘œ êµ¬ë¶„)" />
                                </div>
                                <div className="grid grid-cols-4 items-center gap-4">
                                    <Label htmlFor="introduction" className="text-right">ìê¸°ì†Œê°œ</Label>
                                    <textarea
                                        id="introduction"
                                        className="flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 col-span-3"
                                        value={formData.introduction}
                                        onChange={(e) => setFormData({ ...formData, introduction: e.target.value })}
                                        placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."
                                    />
                                </div>
                            </div>
                            <DialogFooter>
                                <Button type="button" onClick={handleSubmit}>{editingId ? 'ìˆ˜ì • ì™„ë£Œ' : 'ë“±ë¡í•˜ê¸°'}</Button>
                            </DialogFooter>
                        </DialogContent>
                    </Dialog>
                </div>
            </div>

            {/* Search Bar */}
            <div className="relative">
                <Search className="absolute left-3 top-3 h-4 w-4 text-muted-foreground" />
                <Input
                    placeholder="ì´ë¦„, ê¸°ìˆ˜, ì§ì—…, íƒœê·¸ë¡œ ê²€ìƒ‰..."
                    className="pl-10 h-10 w-full md:w-[400px] glass bg-background/50 border-primary/20 focus-visible:ring-primary/30"
                    value={searchTerm}
                    onChange={handleSearch}
                />
            </div>

            {/* Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                {paginatedAlumnae.map((person) => (
                    <Card key={person.id} className="glass group hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border-border/50">
                        <CardContent className="p-6">
                            <div className="flex items-start justify-between mb-4">
                                <Avatar className="h-12 w-12 border-2 border-background shadow-sm">
                                    <AvatarFallback className="bg-gradient-to-br from-pink-100 to-purple-100 text-primary font-bold">
                                        {person.name[0]}
                                    </AvatarFallback>
                                </Avatar>
                                <Badge variant="secondary" className="glass bg-primary/5 text-primary">
                                    {person.cohort}íšŒ
                                </Badge>
                            </div>

                            <div className="space-y-1">
                                <h3 className="font-bold text-lg">{person.name}</h3>
                                <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
                                    <Briefcase className="w-3.5 h-3.5" />
                                    <span className="truncate max-w-[80px]">{person.job}</span>
                                    <span className="text-[10px] opacity-50">|</span>
                                    <span className="truncate max-w-[80px]">{person.company}</span>
                                </div>
                                <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
                                    <MapPin className="w-3.5 h-3.5" />
                                    <span>{person.region}</span>
                                </div>
                            </div>

                            <div className="mt-4 flex flex-wrap gap-1.5">
                                {person.tags.map((tag: string) => (
                                    <span key={tag} className="text-[10px] px-2 py-0.5 rounded-full bg-muted/60 text-muted-foreground border border-border/50">
                                        #{tag}
                                    </span>
                                ))}
                            </div>

                            <div className="mt-4 pt-4 border-t border-border/30 flex gap-2">
                                <Button className="w-full text-xs h-8" variant="outline" onClick={() => setSelectedAlumna(person)}>í”„ë¡œí•„ ë³´ê¸°</Button>
                            </div>
                        </CardContent>
                    </Card>
                ))}
                {paginatedAlumnae.length === 0 && (
                    <div className="col-span-full py-12 text-center text-muted-foreground">
                        ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                )}
            </div>

            {/* Pagination Controls */}
            {totalPages > 0 && (
                <div className="flex items-center justify-center gap-2 py-4">
                    <Button
                        variant="ghost"
                        size="icon"
                        onClick={() => setCurrentPage(1)}
                        disabled={currentPage === 1}
                        title="ì²« í˜ì´ì§€"
                    >
                        <ChevronsLeft className="h-4 w-4" />
                    </Button>
                    <Button
                        variant="ghost"
                        size="icon"
                        onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                        disabled={currentPage === 1}
                        title="ì´ì „ í˜ì´ì§€"
                    >
                        <ChevronLeft className="h-4 w-4" />
                    </Button>

                    <span className="text-sm font-medium min-w-[3rem] text-center">
                        {currentPage} / {totalPages}
                    </span>

                    <Button
                        variant="ghost"
                        size="icon"
                        onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}
                        disabled={currentPage === totalPages}
                        title="ë‹¤ìŒ í˜ì´ì§€"
                    >
                        <ChevronRight className="h-4 w-4" />
                    </Button>
                    <Button
                        variant="ghost"
                        size="icon"
                        onClick={() => setCurrentPage(totalPages)}
                        disabled={currentPage === totalPages}
                        title="ë§ˆì§€ë§‰ í˜ì´ì§€"
                    >
                        <ChevronsRight className="h-4 w-4" />
                    </Button>
                </div>
            )}

            {/* Profile Detail Sheet */}
            <Sheet open={!!selectedAlumna} onOpenChange={(open) => !open && setSelectedAlumna(null)}>
                <SheetContent className="w-full sm:max-w-md p-0 overflow-y-auto bg-background border-l border-border shadow-xl">
                    {selectedAlumna && (
                        <div className="relative h-full flex flex-col">
                            {/* Decorative Header */}
                            <div className="h-32 bg-gradient-to-r from-pink-300 via-purple-300 to-indigo-400 opacity-90 relative">
                                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-30 mix-blend-overlay"></div>
                            </div>

                            <div className="px-6 flex-1 flex flex-col">
                                {/* Profile Header */}
                                <div className="relative -mt-12 mb-6 flex justify-between items-end">
                                    <Avatar className="h-24 w-24 border-4 border-background shadow-xl ring-2 ring-primary/10">
                                        <AvatarFallback className="text-3xl bg-gradient-to-br from-white to-pink-50 text-primary font-bold">
                                            {selectedAlumna.name[0]}
                                        </AvatarFallback>
                                    </Avatar>
                                    <div className="mb-1 text-right">
                                        <Badge variant="secondary" className="text-sm px-3 py-1 shadow-sm bg-background/80 backdrop-blur-md border-primary/20 text-primary">
                                            {selectedAlumna.cohort}íšŒ ì¡¸ì—…ìƒ
                                        </Badge>
                                    </div>
                                </div>

                                <div className="space-y-1 mb-6">
                                    <h2 className="text-2xl font-bold text-foreground flex items-center gap-2">
                                        {selectedAlumna.name}
                                        <span className="text-xs font-normal text-muted-foreground bg-muted px-2 py-0.5 rounded-full">
                                            {selectedAlumna.id <= 6 ? 'ì •íšŒì›' : 'ì‹ ê·œíšŒì›'}
                                        </span>
                                    </h2>
                                    <p className="text-sm font-medium text-primary/80">{selectedAlumna.company} @ {selectedAlumna.job}</p>
                                    <div className="flex items-center gap-1 text-xs text-muted-foreground mt-1">
                                        <MapPin className="w-3 h-3" /> {selectedAlumna.region}
                                    </div>
                                </div>

                                {/* Tags */}
                                <div className="flex flex-wrap gap-2 mb-8">
                                    {selectedAlumna.tags.map((tag: string) => (
                                        <Badge key={tag} variant="outline" className="bg-primary/5 border-primary/20 text-primary hover:bg-primary/10 transition-colors">
                                            #{tag}
                                        </Badge>
                                    ))}
                                </div>

                                <Separator className="mb-6 opacity-50" />

                                {/* Detailed Info */}
                                <div className="space-y-6 flex-1">
                                    <div className="grid grid-cols-1 gap-4">
                                        <div className="bg-muted/30 p-4 rounded-xl border border-border/50 hover:bg-muted/50 transition-colors">
                                            <h3 className="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3 flex items-center gap-2">
                                                <Mail className="w-3.5 h-3.5" /> Contact Info
                                            </h3>
                                            <div className="space-y-3">
                                                <div className="flex items-center justify-between">
                                                    <span className="text-sm text-muted-foreground">Email</span>
                                                    <span className="text-sm font-medium">{selectedAlumna.email}</span>
                                                </div>
                                                <div className="flex items-center justify-between">
                                                    <span className="text-sm text-muted-foreground">Phone</span>
                                                    <span className="text-sm font-medium">{selectedAlumna.phone}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-muted/30 p-4 rounded-xl border border-border/50 hover:bg-muted/50 transition-colors">
                                            <h3 className="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2 flex items-center gap-2">
                                                <Hash className="w-3.5 h-3.5" /> Introduction
                                            </h3>
                                            <p className="text-sm leading-relaxed text-foreground/90">
                                                {selectedAlumna.introduction}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Footer Actions */}
                                <div className="mt-8 mb-6 grid grid-cols-2 gap-3">
                                    <Button className="w-full" variant="outline" onClick={() => handleEdit(selectedAlumna)}>
                                        <Briefcase className="w-4 h-4 mr-2" /> ì •ë³´ ìˆ˜ì •
                                    </Button>
                                    <Button className="w-full hover:bg-destructive hover:text-destructive-foreground" variant="outline" onClick={() => handleDelete(selectedAlumna.id)}>
                                        <div className="flex items-center text-destructive hover:text-destructive-foreground">
                                            <span className="mr-2">ğŸ—‘ï¸</span> ë™ë¬¸ ì‚­ì œ
                                        </div>
                                    </Button>
                                </div>
                            </div>
                        </div>
                    )}
                </SheetContent>
            </Sheet>
        </div>
    )
}
